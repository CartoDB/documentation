## Guides

### Quickstart

There are two main procedures you can use to tilify a dataset, depending on what kind of visualization you need.

1. `tiler.CREATE_SIMPLE_TILESET`
    * Use this procedure if you have a dataset with any geography type (point, line or polygon) and you want to see it at an appropriate zoom level.
    * The geographies will be represented exactly as stored in BigQuery, which means that if they are too small to be visible at a certain zoom level they won't be included as part of that zoom level.
    * The values associated with each feature are exactly the same as the ones available in the source dataset.

2. `tiler.CREATE_POINT_AGGREGATION_TILESET`
    * Use this procedure if you have a point dataset (or something that can be converted to points) and you want to see it aggregated.
    * The points will be aggregated into cells. Each feature or cell represents all the points that fall under it, so the associated properties available for visualization are generated by aggregating the values in the source dataset.
    * Values of individual points are available using single_point_properties which will only be included when a cell includes only one point. Remember that you could also get similar values with the aggregated properties using functions like ANY_VALUE or FIRST_VALUE.

Let's see a couple of quick examples of how the process works.

##### US census blocks (CREATE_SIMPLE_TILESET)

In this example, we want to visualize the US block groups. As those are polygons, we don't want to aggregate them and instead we use the `CREATE_SIMPLE_TILESET` procedure. To be able to style the visualization, we want to keep two properties from the original datasource: a unique identifier (`geoid`) and the population on those blocks (`total_pop`).

```sql
--Use bqcartoeu if using the Spatial Extension in Europe's region
CALL bqcarto.tiler.CREATE_SIMPLE_TILESET(
--SQL to use as the source (uses geom as the name for the geography)
'''
(
  SELECT
    d.geoid,
    d.total_pop,
    g.geom 
  FROM `carto-do-public-data.usa_acs.demographics_sociodemographics_usa_blockgroup_2015_5yrs_20142018` d
  JOIN `carto-do-public-data.carto.geography_usa_blockgroup_2015` g
    ON d.geoid = g.geoid
) _input
''',

-- Name and location where the Tileset will be stored.
  '`MYORGANIZATIONNAME.MYDATASETID.usa_blockgroup_population`',
  
--Options on how to generate the Tileset
  '''{
      "zoom_max": 12,
      "max_tile_size_kb": 3072,
      "properties":{
          "geoid": "String",
          "total_pop": "Number"
       }
 }''');
```

This is the resulting tileset once styled:

![Simple Tileset example](/img/bq-spatial-extension/tiler/quickstart-simpletileset.png)


##### NYC trees (CREATE_POINT_AGGREGATION_TILESET)

We are going to create a tileset for an aggregation of the trees in New York. Since we want to know how many trees are on each cell, we will add a new property to the data: `aggregated_total`. In yellow we specify the source query and in green the name of the target table that will contain the tileset.

With the query ready, you can open your BigQuery console and run it after replacing the target table name.

```sql
--Use bqcartoeu if using the Spatial Extension in Europe's region
CALL bqcarto.tiler.CREATE_POINT_AGGREGATION_TILESET(
--SQL to use as the source (uses geom as the name for the geography)
'''(SELECT ST_GEOGPOINT(longitude, latitude) as geom, * FROM `bigquery-public-data.new_york_trees.tree_census_2015`)''',

-- Name and location where the Tileset will be stored.
-- Replace MYORGANIZATIONNAME.maps.nyc_tress_tileset with
-- YOUR destination where to store the Tileset.
  '`MYORGANIZATIONNAME.MYDATASETID.nyc_trees_tileset`',
  
--Options on how to generate the Tileset
  '''{
      "zoom_max": 14,
      "type": "quadkey",
      "resolution": 8,
      "placement": "features-centroid",
      "properties":{
        "aggregated_total": {
          "formula": "count(*)",
          "type": "Number"
        }
      },
      "single_point_properties": {
           "tree_id": "Number",
           "address": "String"
      }
 }''');
```

Now we can visualize it:

![Point Aggregation Tileset example](/img/bq-spatial-extension/tiler/quickstart-pointaggtileset.png)


### Visualizing a tileset

### Sharing a visualization