## Tiler

CARTO BigQuery Tiler is a solution to visualize very large spatial datasets from BigQuery.

If you have small datasets (few megabytes) on BigQuery you can use available solutions like GeoVizQuery or CARTOframes to visualize them, but if you have millions, or even billions, of rows, you need a system to load them progressively on a map. CARTO BigQuery Tiler allows you to do that without having to move your data out of BigQuery. 

CARTO BigQuery Tiler is:

* Convenient -- You can run it through our UI or directly as SQL commands in BigQuery. The data never leaves BigQuery so you don't have to worry about security and additional ETLs.
* Fast -- CARTO BigQuery Tiler benefits from the massive scalability capabilities of BigQuery and can process hundreds of millions of rows in a few minutes.
* Scalable -- This solution works for 1M points or 100B points.
* Cost-effective -- Since BigQuery separates storage from computing, the actual cost of hosting these Tilesets is very low. Additionally since you run the tiling on demand you only pay for that processing and you don't need to have a cluster available. Finally, thanks to our partitioning technology, serving tiles is very cost effective.


### Guides

#### Quickstart

There are two main procedures you can use to tilify a dataset, depending on what kind of visualization you need.

* `tiler.SimpleTileset`
    * You have a dataset with any geography type (point, line or polygon) and you want to see it at an appropriate zoom level.
    * The geographies will be represented exactly as stored in BigQuery, which means that if they are too small to be visible at a certain zoom level they won't be included as part of that zoom level.
    * The values associated with each feature are exactly the same as the ones available in the source dataset.
* `tiler.CreatePointAggregationTileset`
    * You have a point dataset (or something that can be converted to points) and you want to see it aggregated.
    * The points will be aggregated into cells. Each feature or cell represents all the points that fall under it, so the associated properties available for visualization are generated by aggregating the values in the source dataset.
    * Values of individual points are available using single_point_properties which will only be included when a cell includes only one point. Remember that you could also get similar values with the aggregated properties using functions like ANY_VALUE or FIRST_VALUE.

Let's see a couple of quick examples on how the process works.

##### US census blocks (CreateSimpleTileset)

In this example, we want to visualize the US block groups. As those are polygons, we don't want to aggregate them and instead we use the `CreateSimpleTileset` procedure. To be able to style the visualization, we want to keep two properties from the original datasource: a unique identifier (`geoid`) and the population on those blocks (`total_pop`).

```sql
CALL cartobq.tiler.CreateSimpleTileset(
--SQL to use as the source (uses geom as the name for the geography)
'''
(
  SELECT
    d.geoid,
    d.total_pop,
    g.geom 
  FROM `carto-do-public-data.usa_acs.demographics_sociodemographics_usa_blockgroup_2015_5yrs_20142018` d
  JOIN `carto-do-public-data.carto.geography_usa_blockgroup_2015` g
    ON d.geoid = g.geoid
) _input
''',

-- Name and location where the Tileset will be stored.
  '`MYORGANIZATIONNAME.MYDATASETID.usa_blockgroup_population`',
  
--Options on how to generate the Tileset
  '''{
      "zoom_max": 12,
      "max_tile_size_kb": 3072,
      "properties":{
          "geoid": "String",
          "total_pop": "Number"
       }
 }''');
```

Now we can visualize it:

![simpleTileset example](/img/bq-spatial-extension/quickstart-simpletileset.png)

#### Visualizing a tileset

### Examples